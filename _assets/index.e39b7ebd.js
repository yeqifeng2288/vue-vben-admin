import{u as e,a as t,b as s,r as i,L as n,S as o,p as a,N as r,f as c,a9 as u,v as d}from"./index.29609d4f.js";import{C as l}from"./CheckOutlined.da1c11f2.js";import{D as m}from"./DoubleRightOutlined.97cab3c1.js";import{u as p}from"./useTimeout.972bc5d4.js";import{u as g}from"./useEventListener.baa06eae.js";import{h as f}from"./domUtils.f6eff73e.js";import{g as h}from"./tsxHelper.9170d194.js";import{u as y}from"./useExpose.4dbece1c.js";const{t:v}=e(),x={value:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:[String],default:v("component.verify.dragText")},successText:{type:[String],default:v("component.verify.successText")},height:{type:[Number,String],default:40},width:{type:[Number,String],default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},w={...x,src:{type:String},imgWidth:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}};var T=t({name:"BaseDargVerify",props:x,emits:["success","update:value","change","start","move","end"],setup(e,{emit:t,slots:u}){const d=s({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),f=i(null),v=i(null),x=i(null),w=i(null);n((()=>d.isPassing),(e=>{if(e){const{startTime:s,endTime:i}=d;t("success",{isPassing:e,time:((i-s)/1e3).toFixed(1)}),t("update:value",e),t("change",e)}})),o((()=>{d.isPassing=!!e.value}));const T=a((()=>{const{height:t,actionStyle:s}=e,i=`${parseInt(t)}px`;return{left:0,width:i,height:i,...s}})),S=a((()=>{const{height:t,width:s,circle:i,wrapStyle:n}=e,o=parseInt(t);return{width:`${parseInt(s)}px`,height:`${o}px`,lineHeight:`${o}px`,borderRadius:i?o/2+"px":0,...n}})),b=a((()=>{const{height:t,circle:s,barStyle:i}=e,n=parseInt(t);return{height:`${n}px`,borderRadius:s?n/2+"px 0 0 "+n/2+"px":0,...i}})),D=a((()=>{const{height:t,width:s,contentStyle:i}=e;return{height:`${parseInt(t)}px`,width:`${parseInt(s)}px`,...i}}));function M(e){return e.pageX||e.touches[0].pageX}function P(e){if(d.isPassing)return;const s=c(w);s&&(t("start",e),d.moveDistance=M(e)-parseInt(s.style.left.replace("px",""),10),d.startTime=(new Date).getTime(),d.isMoving=!0)}function $(t){const s=parseInt(t.style.width),{width:i}=e,n=parseInt(i);return{offset:n-s-6,widthNum:n,actionWidth:s}}function I(s){const{isMoving:i,moveDistance:n}=d;if(i){const i=c(w),o=c(v);if(!i||!o)return;const{offset:a,widthNum:r,actionWidth:u}=$(i),d=M(s)-n;t("move",{event:s,moveDistance:n,moveX:d}),d>0&&d<=a?(i.style.left=`${d}px`,o.style.width=`${d+u/2}px`):d>a&&(i.style.left=r-u+"px",o.style.width=r-u/2+"px",e.isSlot||R())}}function j(s){const{isMoving:i,isPassing:n,moveDistance:o}=d;if(i&&!n){t("end",s);const i=c(w),n=c(v);if(!i||!n)return;const a=M(s)-o,{offset:r,widthNum:u,actionWidth:l}=$(i);a<r?e.isSlot?setTimeout((()=>{if(e.value){const e=c(x);e&&(e.style.width=`${parseInt(n.style.width)}px`)}else O()}),0):O():(i.style.left=u-l+"px",n.style.width=u-l/2+"px",R()),d.isMoving=!1}}function R(){e.isSlot?O():(d.endTime=(new Date).getTime(),d.isPassing=!0,d.isMoving=!1)}function O(){d.isMoving=!1,d.isPassing=!1,d.moveDistance=0,d.toLeft=!1,d.startTime=0,d.endTime=0;const e=c(w),t=c(v),s=c(x);e&&t&&s&&(d.toLeft=!0,p((()=>{d.toLeft=!1,e.style.left="0",t.style.width="0"}),300),s.style.width=c(D).width)}return g({el:document,name:"mouseup",listener:()=>{d.isMoving&&O()}}),y({resume:O}),()=>r("div",{class:"darg-verify",ref:f,style:c(S),onMousemove:I,onTouchmove:I,onMouseleave:j,onMouseup:j,onTouchend:j},(()=>{const e=["darg-verify-bar"];return d.toLeft&&e.push("to-left"),r("div",{class:e,ref:v,style:c(b)})})(),(()=>{const t=["darg-verify-content"],{isPassing:s}=d,{text:i,successText:n}=e;return s&&t.push("success"),r("div",{class:t,ref:x,style:c(D)},h(u,"text",s)||(s?n:i))})(),(()=>{const e=["darg-verify-action"],{toLeft:t,isPassing:s}=d;return t&&e.push("to-left"),r("div",{class:e,onMousedown:P,onTouchstart:P,style:c(T),ref:w},h(u,"actionIcon",s)||r(s?l:m,{class:"darg-verify-action__icon"}))})())}}),S=t({name:"ImgRotateDargVerify",inheritAttrs:!1,props:w,emits:["success","change","update:value"],setup(t,{emit:o,attrs:d}){const l=i(null),m=s({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1}),{t:g}=e();n((()=>m.isPassing),(e=>{if(e){const{startTime:t,endTime:s}=m;o("success",{isPassing:e,time:((s-t)/1e3).toFixed(1)}),o("change",e),o("update:value",e)}}));const h=a((()=>{const{imgWrapStyle:e,imgWidth:s}=t;return{width:`${s}px`,height:`${s}px`,...e}})),y=a((()=>{const{minDegree:e,maxDegree:s}=t;return e===s?Math.floor(1+1*Math.random())/10+1:1}));function v(){m.startTime=(new Date).getTime()}function x(e){m.draged=!0;const{imgWidth:s,height:i,maxDegree:n}=t,{moveX:o}=e,a=Math.ceil(o/(s-parseInt(i))*n*c(y));m.currentRotate=a,m.imgStyle=f("transform",`rotateZ(${m.randomRotate-a}deg)`)}function w(){const{minDegree:e,maxDegree:s}=t,i=Math.floor(e+Math.random()*(s-e));m.randomRotate=i,m.imgStyle=f("transform",`rotateZ(${i}deg)`)}function S(){const{randomRotate:e,currentRotate:s}=m,{diffDegree:i}=t;Math.abs(e-s)>=(i||20)?(m.imgStyle=f("transform",`rotateZ(${e}deg)`),m.toOrigin=!0,p((()=>{m.toOrigin=!1,m.showTip=!0}),300)):(m.isPassing=!0,m.endTime=(new Date).getTime()),m.showTip=!0}function b(){m.showTip=!1;const e=c(l);e&&(m.isPassing=!1,e.resume(),w())}const D=u();return D&&(D.resume=b),()=>{const{src:e}=t,{toOrigin:s,isPassing:i,startTime:n,endTime:o}=m,a=[];s&&a.push("to-origin");const u=(o-n)/1e3;return r("div",{class:"ir-dv"},r("div",{class:"ir-dv-img__wrap",style:c(h)},r("img",{src:e,onLoad:w,width:parseInt(t.width),class:a,style:m.imgStyle,onClick:()=>{b()}}),m.showTip&&r("span",{class:["ir-dv-img__tip",m.isPassing?"success":"error"]},m.isPassing?g("component.verify.time",{time:u.toFixed(1)}):g("component.verify.error")),!m.showTip&&!m.draged&&r("span",{class:["ir-dv-img__tip","normal"]},"t('redoTip')")),r(T,{class:"ir-dv-drag__bar",onMove:x,onEnd:S,onStart:v,ref:l,...{...d,...t},value:i,isSlot:!0}))}}});d(T,S);export{T as B,S as R};